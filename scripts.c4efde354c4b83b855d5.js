(()=>{"use strict";let t,e=document.querySelector(".seconds"),i=document.querySelector(".minutes"),s=document.querySelector(".hours"),n=0;function l(){e.innerHTML=o(n%60),i.innerHTML=o(parseInt(n/60)),s.innerHTML=o(parseInt(n/3600)),++n}function o(t){const e=t+"";return e.length<2?"0"+e:e}class r{isDraggable=!1;puzzleRowLength=4;puzzleLength=16;movesCount=0;movesCountElement;grabAnimationClass=[["move-grab"],["move-transition"]];transitionListClass="move-list-item";elementInitialState={x:0,y:0};startPosition={x:0,y:0,offsetTop:0,initialId:0};dragElement=null;dragArea=null;dragDropZone=[];dragElementList=[];startCell={};Axis=!1;startParent;shiftMouseParent=0;cellFrame={};saveList=[];getDivideRest(t){switch((t+1)%this.puzzleRowLength){case 0:return[t-1];case 1:return[t+1];default:return[t-1,t+1]}}getAvailableCells(t){const e=[];return t+this.puzzleRowLength<=this.puzzleLength&&e.push(t+this.puzzleRowLength),t-this.puzzleRowLength>=0&&e.push(t-this.puzzleRowLength),e.push(...this.getDivideRest(t)),e}constructor(t,e,i){this.dragArea=t,this.dragDropZone=e,this.dragElementList=i}setTransitionClass(t,e){this.transitionListClass=t,this.grabAnimationClass=e}checkSequence(){const t=this.dragElementList.sort(((t,e)=>t.id-e.id));console.table(t),this.saveList=t,t.some(((t,e)=>t.id===this.dragDropZone[e]))}setInitInitialState(){this.elementInitialState={x:this.dragElement.offsetLeft,y:dragElement.offsetTop}}setStartPosition(t){const e=this.getDifference({x:t.clientX,y:t.clientY},this.dragArea);e.y+=this.dragElement.offsetTop-this.dragElement.style.top.replace("px",""),this.startPosition=this.getDifference(e,this.dragElement),this.startPosition.offsetTop=this.dragElement.offsetTop,this.Axis=this.getAxis(t,this.getDifference({x:t.clientX,y:t.clientY},this.dragArea)),this.startParent=this.findDragElement().parentId,this.setDraggableBorders(t),this.startCell=this.getDistanceRectCoord(this.getParentCell().item,this.dragElement),this.cellFrame=this.getAvailableCoord(this.getParentCell()),this.isDraggable=!0}getParentCell(t=this.startParent){return this.dragDropZone[t]}setElementPosition(t,{x:e,y:i}){t.style.left=e+"px",t.style.top=i+"px"}toggleElementClass(t,e=!1,[i,s]=this.grabAnimationClass){[i,s]=e?[s,i]:[i,s],t.classList.add(...i),t.classList.remove(...s)}getDifference(t,e){return{x:t.x-e.offsetLeft,y:t.y-e.offsetTop}}checkElementCrossing(t,e){const i=t.filter((({zone:t})=>this.checkIsCrossing(e,zone)));return 0!==i.length?i[0].id:null}checkIsCrossing(t,e){return t.top>e.top-t.height/2&&t.bottom-t.height/2<e.bottom&&t.left>e.left-t.width/2&&t.right-t.width/2<e.right}setSingleTransition(t,e=this.transitionListClass){t.item.classList.add(e),t.item.addEventListener("transitionend",(()=>{t.item.classList.remove(e)}))}checkIsContainsTransition(t,e=this.transitionListClass){return t.item.classList.contains(e)}findDragElement(t=null){return null!==t?this.dragElementList.find((e=>e.id===t)):this.dragElementList.find((t=>t.item===this.dragElement))}getDistanceRectCoord(...t){return{x:this.getDistanceRect(...t,"left"),y:this.getDistanceRect(...t)}}getDistanceRect(t,e,i="top"){return t.getBoundingClientRect()[i]-e.getBoundingClientRect()[i]+Number(e.style[i].replace("px",""))}setEmptyCell(){}getAxis(t){return{x:t.clientY>this.emptyCell.item.getBoundingClientRect().top&&t.clientY<this.emptyCell.item.getBoundingClientRect().bottom,y:t.clientX>this.emptyCell.item.getBoundingClientRect().left&&t.clientX<this.emptyCell.item.getBoundingClientRect().right}}getAvailableCoord(t){const e=t.item.getBoundingClientRect(),i=this.emptyCell.item.getBoundingClientRect();return{left:e.left<=i.left?e.left:i.left,right:e.right>=i.right?e.right:i.right,top:e.top<=i.top?e.top:i.top,bottom:e.bottom>=i.bottom?e.bottom:i.bottom}}checkAvailablePoints(t,e,i){return i?t.top>e.top&&t.bottom<e.bottom:t.left>e.left&&t.right<e.right}moveDragElement(t,e={}){if(this.isDraggable){const e=this.getDifference({x:t.clientX,y:t.clientY},this.dragArea),i=this.Axis.x?{x:e.x-this.startPosition.x,y:this.startCell.y}:this.Axis.y?{x:this.startCell.x,y:e.y-this.startPosition.y}:null,s={left:t.clientX-this.shiftMouseParent.left,right:t.clientX+this.shiftMouseParent.right,top:t.y-this.shiftMouseParent.top,bottom:t.clientY+this.shiftMouseParent.bottom};null!==i&&this.checkAvailablePoints(s,this.cellFrame,this.Axis.y)&&this.setElementPosition(this.dragElement,i)}}watchCrossingList(t){const e=this.findDragElement();this.moveDragElement(t);const i=this.dragDropZone.filter((({item:t})=>this.checkIsCrossing(this.dragElement.getBoundingClientRect(),t.getBoundingClientRect())&&this.dragElement!==t))[0];if(i&&this.isDraggable){if(null!==i.nestedId)return;const t=e.parentId;i.nestedId=e.id,e.parentId=i.id,this.getParentCell(t).nestedId=null}}setDefaultPosition(t=[]){const e=0!==t.length;this.dragElementList.forEach(((i,s)=>{const n=e?t[s]:s;this.setElementPosition(i.item,this.getDistanceRectCoord(this.getParentCell(n).item,i.item))}))}setResizePosition(){this.dragElementList.forEach(((t,e)=>{this.setElementPosition(t.item,this.getDistanceRectCoord(this.getParentCell(t.parentId).item,t.item))}))}setDraggableBorders(t){const e=this.getParentCell().item.getBoundingClientRect();this.shiftMouseParent={left:t.clientX-e.left-10,right:e.right-t.clientX-10,bottom:e.bottom-t.clientY-10,top:t.clientY-e.top-10}}dropListener=t=>{t.preventDefault(),this.isDraggable&&this.dropDragElement()};removeMouseUpListener=t=>{t.preventDefault(),this.triggerMouseEvent(this.dragElement,"mouseup"),this.dragElement.removeEventListener("mouseup",this.dropListener)};startDragElementList(t,e){this.dragElement=e,t.preventDefault(),this.setStartPosition(t),this.dragArea.addEventListener("mousemove",(t=>{this.getAvailableCells(this.emptyCell.id).includes(this.startParent)&&this.watchCrossingList(t)})),this.dragElement.addEventListener("mouseleave",this.dropListener,{once:!0}),this.dragElement.addEventListener("mouseup",this.dropListener,{once:!0})}triggerMouseEvent(t,e){console.log("MOVING");let i=document.createEvent("MouseEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}moveSolution(){this.isDraggable=!1;const{parentId:t,id:e,moveTo:i}=this.movesPathList.pop(),s=this.findDragElement(e),n=this.getParentCell(i).item;console.log(t,e,i),console.log(s,n);const l=this.getDistanceRectCoord(n,s.item);this.setElementPosition(s.item,l),this.setSingleTransition(s),this.emptyCell=this.dragDropZone[t],this.dragDropZone[t].nestedId=null,s.item.classList.add(this.transitionListClass),s.item.addEventListener("transitionend",(()=>{0!==this.movesPathList.length&&this.moveSolution(),s.item.classList.remove(this.transitionListClass)}))}movesPathList=[];addMovesPathList=({parentId:t,item:e,id:i})=>{this.movesPathList.push({parentId:t,id:i,moveTo:this.startParent})};dropDragElement(){this.isDraggable=!1;const t=this.findDragElement(),e=this.getDistanceRectCoord(this.getParentCell(t.parentId).item,this.dragElement);this.setElementPosition(this.dragElement,e),this.setSingleTransition(this.findDragElement()),this.checkSequence(),t.parentId!==this.startParent&&(console.log(t),this.addMovesPathList(t),console.log(this.movesPathList),this.emptyCell=this.getParentCell(),this.getParentCell().nestedId=null,this.movesCount++,this.movesCountElement(this.movesCount))}}const a=(t="",e="")=>`\n    <div class='puzzle__cell data-order=${e}'>\n    ${t}\n    </div>\n  `,h=document.querySelector(".controlSelect"),g=document.querySelector(".controlReset"),c=document.querySelector(".controlSave"),d=document.querySelector(".controlLoad"),m=document.querySelector(".movesCount"),u=document.querySelector("#soundCheck"),p=document.getElementById("myAudio");let f=null;p.playbackRate=1.4,c.addEventListener("click",(()=>{y("")})),d.addEventListener("click",(()=>{P("")}));let E=16;function v(t){let e=t.length;for(;--e>0;){let i=Math.floor(Math.random()*(e+1));[t[i],t[e]]=[t[e],t[i]],console.log(e+1,i+1)}return t}h.addEventListener("change",(t=>{E=t.target.value**2,S(),console.log(E)})),g.addEventListener("click",(o=>{console.log("RESET"),S(),t?(clearInterval(t),t=null,e.innerHTML="00",i.innerHTML="00",s.innerHTML="00",n=0,t=setInterval(l,1e3),l()):(t=setInterval(l,1e3),l())}));const C=t=>{for(var e=0,i=1,s=t.length-1;i<s;i++)for(var n=i-1;n>=0;n--)t[n]>t[i]&&e++;return!(e%2)},L=document.querySelector(".puzzle__list"),y=t=>{if(null!==f.saveList.length){const t=f.saveList.map((t=>t.parentId));console.log("EMPTY",f.emptyCell),localStorage.setItem("itemList",JSON.stringify(t)),localStorage.setItem("timer",JSON.stringify(getTimerValue)),localStorage.setItem("moves",JSON.stringify(f.movesCount)),localStorage.setItem("emptyCell",JSON.stringify(f.emptyCell.id))}},P=()=>{const t=JSON.parse(localStorage.getItem("itemList")),e=JSON.parse(localStorage.getItem("emptyCell"));console.log(e),S(t,e)},D=t=>{m.innerHTML=`Moves ${t}`},S=(t=[],e=null)=>{const i=0!==t.length?Array(E).fill(0).map(((t,e)=>e)):function(t){const e=Array(t).fill(0).map(((t,e)=>e));let i=[];for(;;)if(i=v(e),C(i))return i}(E);console.table(i),L.setAttribute("style",((t=3)=>`grid-template-columns: repeat(${t}, 1fr);\n    grid-template-rows: repeat(${t}, 1fr);font-size:${90/t}px;`)(Math.sqrt(E)));const s=((t=16)=>Array(t).fill(0).map(((t,e)=>a("",e))))(E);var n;s[0]=a([...(n=i,n.map((t=>((t="",e=0)=>`\n    <div class='puzzle__item${t}' data-order=${e}>\n    <p>${e+1}</p>\n    </div>\n  `)("",t))))],0),L.innerHTML=[...s].toString().replaceAll(",","");const l=document.querySelectorAll(".puzzle__item"),o=document.querySelectorAll(".puzzle__cell"),h=t=>{const e=t.find((t=>t.id===E-1));return t.indexOf(e)};console.log("GAME SET");const g=[...l].map(((e,i)=>({item:e,parentId:0!==t.length?t[i]:i,id:Number(e.dataset.order)}))),c=[...o].map(((t,e)=>(g[e]&&g[e].id,{item:t,nestedId:g[e].id,id:e}))),d=0!==t.length?e:h(g);f=new r(L,[...c],g),f.movesCountElement=D,c.at(d).nestedId=null,g[h(g)].item.classList.add("hide"),f.emptyCell=e?c.at(e):c.at(d),console.log("SET EMPTY",f.emptyCell),f.setDefaultPosition(t),f.puzzleRowLength=Math.sqrt(E),f.puzzleLength=E,l.forEach(((t,e)=>{t.addEventListener("mousedown",(e=>{var i;u.checked&&p.play(),f.startDragElementList(e,t),i=g,console.log(Array.isArray(i)),i.every((t=>(console.log("ON PLACE",t.id===t.parentId),t.id===E.length-1||t.id===t.parentId)))&&alert("VICTORY")}))})),window.addEventListener("resize",(function(t){L.clientWidth<1100?(console.log("LESS"),f.setResizePosition()):console.log("more")}))};S()})();
//# sourceMappingURL=scripts.c4efde354c4b83b855d5.js.map